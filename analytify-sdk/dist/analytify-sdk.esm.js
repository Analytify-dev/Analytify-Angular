const e={clientId:"",clientSecret:"",apiBaseUrl:"",tokenEndpoint:"http://13.57.231.251:50/v1"};let n=null,t=0;function o(n){if(!n||!n.clientId||!n.apiBaseUrl)throw new Error("AnalytifySDK.init: clientId and apiBaseUrl are required");return e.clientId=n.clientId,e.clientSecret=n.clientSecret||"",e.apiBaseUrl=n.apiBaseUrl.replace(/\/+$/,""),n.tokenEndpoint&&(e.tokenEndpoint=n.tokenEndpoint),{init:o,loadDashboard:i,embedSheet:a}}function r(){if(n&&Date.now()<t-6e4)return Promise.resolve(n);const o=e.tokenEndpoint+"/app_access_token/";return fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e.clientId,client_secret:e.clientSecret})}).then((e=>{if(!e.ok)throw new Error("Token fetch failed: "+e.status+" "+e.statusText);return e.json()})).then((e=>(n=e.data.access_token,t=Date.now()+1e3*(e.data.expires_in||0),n)))}function i(n){if(!e.clientId||!e.apiBaseUrl)return void console.error("AnalytifySDK.loadDashboard: SDK not initialized; call init() first");if(!n||!n.dashboardToken||!n.container)return void console.error("AnalytifySDK.loadDashboard: Missing required options: dashboardToken, container");const t="string"==typeof n.container?document.querySelector(n.container):n.container;if(t)return r().then((o=>{let r=e.apiBaseUrl+"/embed/dashboard/"+encodeURIComponent(n.dashboardToken)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(e.clientId);const i=[];n.filters&&"object"==typeof n.filters&&i.push("filters="+encodeURIComponent(JSON.stringify(n.filters))),i.length&&(r+="?"+i.join("&"));const a=document.createElement("iframe");return a.src=r,a.style.border="none",a.style.width=n.width||"100%",a.style.height=n.height||"100%",t.innerHTML="",t.appendChild(a),a})).catch((e=>{console.error("AnalytifySDK.loadDashboard error:",e)}));console.error("AnalytifySDK.loadDashboard: Container not found",n.container)}function a(n){if(!e.clientId||!e.apiBaseUrl)return void console.error("AnalytifySDK.embedSheet: SDK not initialized; call init() first");if(!n||!n.sheetToken||!n.container)return void console.error("AnalytifySDK.embedSheet: Missing required options: sheetToken, container");const t="string"==typeof n.container?document.querySelector(n.container):n.container;if(t)return r().then((o=>{let r=e.apiBaseUrl+"/embed/sheet/"+encodeURIComponent(n.sheetToken)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(e.clientId);const i=[];n.filters&&"object"==typeof n.filters&&i.push("filters="+encodeURIComponent(JSON.stringify(n.filters))),i.length&&(r+="?"+i.join("&"));const a=document.createElement("iframe");return a.src=r,a.style.border="none",a.style.width=n.width||"100%",a.style.height=n.height||"100%",t.innerHTML="",t.appendChild(a),a})).catch((e=>{console.error("AnalytifySDK.embedSheet error:",e)}));console.error("AnalytifySDK.embedSheet: Container not found",n.container)}var c={init:o,loadDashboard:i,embedSheet:a};export{c as default,a as embedSheet,o as init,i as loadDashboard};
