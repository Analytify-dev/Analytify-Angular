!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).AnalytifySDK={})}(this,(function(e){"use strict";const n={clientId:"",clientSecret:"",apiBaseUrl:"",tokenEndpoint:"http://13.57.231.251:50/v1"};let t=null,o=0;function i(e){if(!e||!e.clientId||!e.apiBaseUrl)throw new Error("AnalytifySDK.init: clientId and apiBaseUrl are required");return n.clientId=e.clientId,n.clientSecret=e.clientSecret||"",n.apiBaseUrl=e.apiBaseUrl.replace(/\/+$/,""),e.tokenEndpoint&&(n.tokenEndpoint=e.tokenEndpoint),{init:i,loadDashboard:a,embedSheet:d}}function r(){if(t&&Date.now()<o-6e4)return Promise.resolve(t);const e=n.tokenEndpoint+"/app_access_token/";return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n.clientId,client_secret:n.clientSecret})}).then((e=>{if(!e.ok)throw new Error("Token fetch failed: "+e.status+" "+e.statusText);return e.json()})).then((e=>(t=e.data.access_token,o=Date.now()+1e3*(e.data.expires_in||0),t)))}function a(e){if(!n.clientId||!n.apiBaseUrl)return void console.error("AnalytifySDK.loadDashboard: SDK not initialized; call init() first");if(!e||!e.dashboardToken||!e.container)return void console.error("AnalytifySDK.loadDashboard: Missing required options: dashboardToken, container");const t="string"==typeof e.container?document.querySelector(e.container):e.container;if(t)return r().then((o=>{let i=n.apiBaseUrl+"/embed/dashboard/"+encodeURIComponent(e.dashboardToken)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(n.clientId);const r=[];e.filters&&"object"==typeof e.filters&&r.push("filters="+encodeURIComponent(JSON.stringify(e.filters))),r.length&&(i+="?"+r.join("&"));const a=document.createElement("iframe");return a.src=i,a.style.border="none",a.style.width=e.width||"100%",a.style.height=e.height||"100%",t.innerHTML="",t.appendChild(a),a})).catch((e=>{console.error("AnalytifySDK.loadDashboard error:",e)}));console.error("AnalytifySDK.loadDashboard: Container not found",e.container)}function d(e){if(!n.clientId||!n.apiBaseUrl)return void console.error("AnalytifySDK.embedSheet: SDK not initialized; call init() first");if(!e||!e.sheetToken||!e.container)return void console.error("AnalytifySDK.embedSheet: Missing required options: sheetToken, container");const t="string"==typeof e.container?document.querySelector(e.container):e.container;if(t)return r().then((o=>{let i=n.apiBaseUrl+"/embed/sheet/"+encodeURIComponent(e.sheetToken)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(n.clientId);const r=[];e.filters&&"object"==typeof e.filters&&r.push("filters="+encodeURIComponent(JSON.stringify(e.filters))),r.length&&(i+="?"+r.join("&"));const a=document.createElement("iframe");return a.src=i,a.style.border="none",a.style.width=e.width||"100%",a.style.height=e.height||"100%",t.innerHTML="",t.appendChild(a),a})).catch((e=>{console.error("AnalytifySDK.embedSheet error:",e)}));console.error("AnalytifySDK.embedSheet: Container not found",e.container)}var l={init:i,loadDashboard:a,embedSheet:d};e.default=l,e.embedSheet=d,e.init=i,e.loadDashboard=a,Object.defineProperty(e,"__esModule",{value:!0})}));
