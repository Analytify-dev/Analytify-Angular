"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e={clientId:"",clientSecret:"",apiBaseUrl:"",tokenEndpoint:"http://13.57.231.251:50/v1"};let t=null,n=0;function o(t){if(!t||!t.clientId||!t.apiBaseUrl)throw new Error("AnalytifySDK.init: clientId and apiBaseUrl are required");return e.clientId=t.clientId,e.clientSecret=t.clientSecret||"",e.apiBaseUrl=t.apiBaseUrl.replace(/\/+$/,""),t.tokenEndpoint&&(e.tokenEndpoint=t.tokenEndpoint),{init:o,loadDashboard:i,embedSheet:a}}function r(){if(t&&Date.now()<n-6e4)return Promise.resolve(t);const o=e.tokenEndpoint+"/app_access_token/";return fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:e.clientId,client_secret:e.clientSecret})}).then((e=>{if(!e.ok)throw new Error("Token fetch failed: "+e.status+" "+e.statusText);return e.json()})).then((e=>(t=e.data.access_token,n=Date.now()+1e3*(e.data.expires_in||0),t)))}function i(t){if(!e.clientId||!e.apiBaseUrl)return void console.error("AnalytifySDK.loadDashboard: SDK not initialized; call init() first");if(!t||!t.dashboardToken||!t.container)return void console.error("AnalytifySDK.loadDashboard: Missing required options: dashboardToken, container");const n="string"==typeof t.container?document.querySelector(t.container):t.container;if(n)return r().then((o=>{let r=e.apiBaseUrl+"/embed/dashboard/"+encodeURIComponent(t.dashboardToken)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(e.clientId);const i=[];t.filters&&"object"==typeof t.filters&&i.push("filters="+encodeURIComponent(JSON.stringify(t.filters))),i.length&&(r+="?"+i.join("&"));const a=document.createElement("iframe");return a.src=r,a.style.border="none",a.style.width=t.width||"100%",a.style.height=t.height||"100%",n.innerHTML="",n.appendChild(a),a})).catch((e=>{console.error("AnalytifySDK.loadDashboard error:",e)}));console.error("AnalytifySDK.loadDashboard: Container not found",t.container)}function a(t){if(!e.clientId||!e.apiBaseUrl)return void console.error("AnalytifySDK.embedSheet: SDK not initialized; call init() first");if(!t||!t.sheetToken||!t.container)return void console.error("AnalytifySDK.embedSheet: Missing required options: sheetToken, container");const n="string"==typeof t.container?document.querySelector(t.container):t.container;if(n)return r().then((o=>{let r=e.apiBaseUrl+"/embed/sheet/"+encodeURIComponent(t.sheetToken)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(e.clientId);const i=[];t.filters&&"object"==typeof t.filters&&i.push("filters="+encodeURIComponent(JSON.stringify(t.filters))),i.length&&(r+="?"+i.join("&"));const a=document.createElement("iframe");return a.src=r,a.style.border="none",a.style.width=t.width||"100%",a.style.height=t.height||"100%",n.innerHTML="",n.appendChild(a),a})).catch((e=>{console.error("AnalytifySDK.embedSheet error:",e)}));console.error("AnalytifySDK.embedSheet: Container not found",t.container)}var s={init:o,loadDashboard:i,embedSheet:a};exports.default=s,exports.embedSheet=a,exports.init=o,exports.loadDashboard=i;
