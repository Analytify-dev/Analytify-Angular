<app-page-header title="Workbench" title1="home" activeitem="workbench"></app-page-header>
<!-- CONTAINER -->



<!-- <div class="example-container" cdkDropListGroup cdkScrollable>
    <h2>Tables</h2>
      <div
      cdkDropList
      #originList="cdkDropList"
      [cdkDropListData]="tableList"
      [cdkDropListConnectedTo]="[destinationList]"
      class="example-list"
      (cdkDropListDropped)="drop($event)">
      @for(item of tableList; track item){
      <div class="example-box"  cdkDrag>{{item.table}}</div>
      }
    </div>

      <h2>relation</h2>

    <div
      cdkDropList
      #destinationList="cdkDropList"
      [cdkDropListData]="draggedtables"
      class="example-list"
      (cdkDropListDropped)="drop($event)">
      @for(item of draggedtables;track item){
      <div class="example-box"  cdkDrag>{{item.table}}</div>
      }
    </div>
</div> -->


<ng-template #mdo let-modal >

    <div  >
      <div >
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="inputModalLabel">PostgreSQL</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="modal.close('cross click')"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-2">
                <label for="recipient-name" class="col-form-label">Server:</label>
                <input type="text" class="form-control" [(ngModel)]="postGreServerName" [ngModelOptions]="{standalone: true}">
              </div>
              <div class="mb-2">
                <label for="message-text" class="col-form-label">Port:</label>
                <input type="text" class="form-control" [(ngModel)]="postGrePortName" [ngModelOptions]="{standalone: true}">
              </div>
              <div class="mb-2">
                <label class="col-form-label">Database:</label>
                <input type="text" class="form-control" [(ngModel)]="postGreDatabaseName" [ngModelOptions]="{standalone: true}">
              </div>
              <div class="mb-2">
                <label class="col-form-label">Username:</label>
                <input type="text" class="form-control" [(ngModel)]="postGreUserName" [ngModelOptions]="{standalone: true}">
              </div>
              <div class="mb-2">
                <label class="col-form-label">Password:</label>
                <input type="text" class="form-control" [(ngModel)]="PostGrePassword" [ngModelOptions]="{standalone: true}">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="modal.close('cross click')">Close</button>
            <button type="button" class="btn btn-primary" (click)="postgreSignIn()">Sign In</button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>



<!-- screen2 -->
@if(databaseconnectionsList){
  <div class="main-container container-fluid">
    <div class="row" class="card" style="flex-direction: row;padding: 20px;">
    <div class="col-sm-12 col-lg-12 col-xl-3" style="padding: 0px;" id="lists" #lists>
            <!-- <div class="card-header">
                <h3 class="card-title">Database Connections</h3>
            </div> -->
                <div class="">
                    <ul class="list-group">
                        <li class="list-group-item active">Big Data Platform</li>
                        <li class="list-group-item">Hadoop</li>
                        <li class="list-group-item">Green Plum</li>
                        <li class="list-group-item">Kyln</li>
                        
                    </ul>
                    <ul class="list-group">
                        <li class="list-group-item active">Multi-dimensional Database</li>
                        <li class="list-group-item">SAP HANA</li>
                        <li class="list-group-item">SAP BW</li>
                        <li class="list-group-item">SSAS</li>
                        <li class="list-group-item">EssBase</li>
                    </ul>
                </div>
    </div>
    <div class="col-sm-12 col-lg-12 col-xl-3" style="padding: 0px;" id="lists" #lists>
            <!-- <div class="card-header">
                <h3 class="card-title">Active List item</h3>
            </div> -->
                <div class="">
                    <ul class="list-group">
                        <li class="list-group-item active">Relational Database</li>
                        <li class="list-group-item" style="background-color: #e7ffe7;">Oracle</li>
                        <li class="list-group-item">DB2</li>
                        <li class="list-group-item">PMySQL</li>
                        <li class="list-group-item">SQL Server</li>
                        <li class="list-group-item">Access</li>
                        <li class="list-group-item" (click)="openPostgreSql()" style="background-color: #e7ffe7;">PostgreSQL</li>
                        <li class="list-group-item">Sybase</li>
                        <li class="list-group-item">Informix</li>
                    </ul>
                </div>
    </div>
    <div class="col-sm-12 col-lg-12 col-xl-3" style="padding: 0px;" id="lists" #lists>
        <!-- <div class="card-header">
            <h3 class="card-title">Active List item</h3>
        </div> -->
            <div class="">
                <ul class="list-group">
                    <li class="list-group-item active">NoSQL Database</li>
                    <li class="list-group-item">MongoDB</li>
                    <li class="list-group-item">SQLite</li>
                    <li class="list-group-item">Cassandra</li>
                </ul>
                <!-- <ul class="list-group">
                    <li class="list-group-item active">File Source</li>
                    <li class="list-group-item">Excel</li>
                    <li class="list-group-item">TXT</li>
                    <li class="list-group-item">XML</li>
                    <li class="list-group-item">CSV</li>
                </ul> -->
        </div>
    </div>
    <div class="col-sm-12 col-lg-12 col-xl-3" style="padding: 0px;" id="lists" #lists>
        <!-- <div class="card-header">
            <h3 class="card-title">Active List item</h3>
        </div> -->
            <div class="">
                <ul class="list-group">
                    <li class="list-group-item active">Program Data Source&Others</li>
                    <li class="list-group-item">Java API</li>
                    <li class="list-group-item">Hibernate</li>
                    <li class="list-group-item">Webservice Data Source</li>
                    <li class="list-group-item">SOA Data Source</li>
                    <li class="list-group-item">Analytics Data Source</li>
                    <li class="list-group-item">ODBC Data Source</li>
                    <li class="list-group-item">JNDI Data Source</li>
                    <li class="list-group-item">SAp Data Source</li>
                </ul>
        </div>
    </div>   
    </div>
  </div>
}
  <!-- screen3 -->
  @if(openPostgreSqlForm){
  <div class="main-container container-fluid" style="display: flex;justify-content: center;">
    <div class="col-md-12 col-xl-6">
        <div class="card">
            <div class="card-header">
                <h4 class="card-title">Connect To PostGreSQL</h4>
            </div>
            <div class="card-body">
                <form>
                    <div class="mb-2">
                        <label for="recipient-name" class="col-form-label">Server:</label>
                        <input type="text" class="form-control" [(ngModel)]="postGreServerName" [ngModelOptions]="{standalone: true}">
                      </div>
                      <div class="mb-2">
                        <label for="message-text" class="col-form-label">Port:</label>
                        <input type="text" class="form-control" [(ngModel)]="postGrePortName" [ngModelOptions]="{standalone: true}">
                      </div>
                      <div class="mb-2">
                        <label class="col-form-label">Database:</label>
                        <input type="text" class="form-control" [(ngModel)]="postGreDatabaseName" [ngModelOptions]="{standalone: true}">
                      </div>
                      <div class="mb-2">
                        <label class="col-form-label">Username:</label>
                        <input type="text" class="form-control" [(ngModel)]="postGreUserName" [ngModelOptions]="{standalone: true}">
                      </div>
                      <div class="mb-2">
                        <label class="col-form-label">Password:</label>
                        <input type="text" class="form-control" [(ngModel)]="PostGrePassword" [ngModelOptions]="{standalone: true}">
                      </div>
                      <div style="float: right;">
                        <button type="button" class="btn btn-secondary mt-4 mb-0" style="margin-right: 20px;">Close</button>
                        <button type="button" class="btn btn-primary mt-4 mb-0" (click)="postgreSignIn()">Sign In</button>
                      </div>
                </form>
            </div>
        </div>
    </div>
  </div>
    }


    <!-- screen4Tables -->
    @if(openTablesUI){
        <div class="main-container container-fluid">
            <div class="row" cdkListGroup>
                    <div class="col-xxl-2 col-xl-2 col-lg-2 col-md-5">
                    <div class="card" style="height: 560px;">
                        <div class="card-header" style="justify-content: center;">
                            <!-- <div class="dropdown" ngbDropdown>
                                <button class="btn btn-primary dropdown-toggle" ngbDropdownToggle type="button"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Data Connections
                                </button>
                                <ul class="dropdown-menu" ngbDropdownMenu style>
                                    <li><a class="dropdown-item" ngbDropdownItem>Oracle</a></li>
                                    <li><a class="dropdown-item" (click)="Openmdo(mdo)" ngbDropdownItem>PostGreSQL</a></li>
                                </ul>
                            </div> -->
                            <label class="list-group-item active">{{databaseName}}</label>
                        </div>
                        @if(tableList.length){ 
                        <div class="card-body" style="padding: 0px;">
                            <div
                            cdkDropList
                            #originList="cdkDropList"
                            [cdkDropListData]="tableList"
                            [cdkDropListConnectedTo]="[destinationList]"
                            class="example-list"
                            (cdkDropListDropped)="drop($event)">
                            @for(item of tableList; track item; let i = $index){
                                <!-- @for(value of item.data;track value){
                                    <div class="example-box"  cdkDrag>{{value.table}} ({{item.schema}})</div>
                                } -->
                                <div class="example-box"  cdkDrag>{{item.table}} ({{item.schema}})</div>

                            }
                          </div>
                        </div>
                    }
                    </div>
                </div>
                <div class="col-xxl-4 col-xl-4 col-lg-7 col-md-7">
                    <div class="card" style="height: 350px;">
                        <div class="card-header">
                            <label>Drag Tables Here</label>
                        </div>
                        <div class="card-body">
                            <div cdkDropList #destinationList="cdkDropList" [cdkDropListData]="draggedtables" class="example-list-drop"
                                (cdkDropListDropped)="drop($event)">
                                @for(item of draggedtables;track $index){
                                <div class="example-box" cdkDrag>{{item.table}}({{item.schema}})
                                    <i class="mdi mdi-delete" data-bs-toggle="tooltip" (click)="onDeleteItem($index)" ngbTooltip="mdi mdi-delete"></i>
                                </div>
                                }
                            </div>
                        </div>
                    </div>
                    <!-- <div class="col-xxl-10 col-xl-8 col-lg-7 col-md-7">
                        <div class="card">
                            <div class="card-header">
                
                            </div>
                            <div class="card-body">
                
                            </div>
                
                        </div>
                    </div> -->
                </div>
                
                <div class="col-xxl-6 col-xl-6 col-lg-7 col-md-7">
                    <div class="card" style="height: 350px;">
                        <div class="card-header">
                            <label>Table Relations</label>
                            <div style="margin-left: 400px">
                            <button class="btn btn-primary" aria-expanded="false" (click)="tableRelationUi=!tableRelationUi">
                                Add
                            </button>
                        </div>
                        </div>
                        @if(draggedtables.length > 1){
                        <div class="card-body">
                            @if(tableRelationUi){
                            <div class="row">
                                <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-3">
                                    <label>{{draggedtables[0]?.table}}({{draggedtables[0]?.schema}})</label>
                                    <div class="btn-group my-2" ngbDropdown>
                                        <button type="button" class="btn btn-default dropdown-toggle" ngbDropdownToggle data-bs-toggle="dropdown" aria-expanded="false">
                                            {{ selectedClmnT1 ? selectedClmnT1 : 'Columns' }}
                                        </button>
                                        <ul class="dropdown-menu" ngbDropdownMenu>
                                            @for(data of draggedtables[0]?.columns;track data){
                                                <li>
                                            <a class="dropdown-item" ngbDropdownItem (click)="selectedClmnT1 = data.columns + ' (' + data.datatypes + ')'">{{data.columns}}({{data.datatypes}})</a>
                                                
                                            </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-3" >
                                    <div style="display: flex;justify-content: center;"><label>operator</label></div>
                                    <div class="btn-group my-2" style="display: flex;justify-content: center;" ngbDropdown>
                                        <button type="button" class="btn btn-default dropdown-toggle" ngbDropdownToggle data-bs-toggle="dropdown" aria-expanded="false">
                                            {{ selectedCndn ? selectedCndn : 'Condition' }}
                                        </button>
                                        <ul class="dropdown-menu" ngbDropdownMenu>
                                            <li><a class="dropdown-item" (click)="selectedCndn = '='" ngbDropdownItem >equals(=)</a></li>
                                           
                                        </ul>
                                    </div>
                                 </div>
                                <div class="col-xxl-4 col-xl-4 col-lg-4 col-md-3">
                                    <label>{{draggedtables[1]?.table}}({{draggedtables[1]?.schema}})</label>
                                    <div class="btn-group my-2" ngbDropdown>
                                        <button type="button" class="btn btn-default dropdown-toggle" ngbDropdownToggle data-bs-toggle="dropdown" aria-expanded="false">
                                            {{ selectedClmnT2 ? selectedClmnT2 : 'Columns' }}
                                        </button>
                                        <ul class="dropdown-menu" ngbDropdownMenu>
                                            @for(data of draggedtables[1]?.columns;track data){
                                            <li>
                                            <a class="dropdown-item" ngbDropdownItem (click)="selectedClmnT2 = data.columns + ' (' + data.datatypes + ')';buildCustomRelation()">{{data.columns}}({{data.datatypes}})</a>                                               
                                            </li>
                                            }
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        }
                            <div>
                                @if(relationOfTables.length){
                                    <div class="card-header">
                                        <h3 class="card-title">Relations:</h3>
                                    </div>                                   
                                    <ul class="tags">
                                        @for(relation of relationOfTables;track relation;let i = $index){
                                        <li class="tag">{{relation}}</li>
                                        }
                                    </ul>                            
                                }
                                @if(!relationOfTables.length){
                                    <div class="card-header">
                                        <h3 class="card-title">Relations:</h3>
                                    </div>                                   
                                    <ul class="tags">
                                        <li class="tag">No relation found</li>
                                    </ul>                            
                                }
                            </div>
                           
                        </div>
                    }
                    </div>
                </div>
                @if(draggedtables.length){
                <div  class="col-xxl-10 col-xl-10 col-lg-7 col-md-7 side-card">
                    <div class="row">
                        <div class="col-xxl-12 col-xl-12 col-lg-6 col-md-6">
                            <div  class="card">
                                <div class="card-header">
                                    <!-- <label>Table Data</label> -->
                                    @if(draggedtables && draggedtables[1]){
                                         <div class="dropdown" ngbDropdown>
                                <button class="btn btn-primary dropdown-toggle" ngbDropdownToggle type="button"
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                    Tables
                                </button>
                                <ul class="dropdown-menu" ngbDropdownMenu style>
                                    @for(tables of draggedtables;track tables){
                                    <li><a class="dropdown-item" (click)="getTablerowclms(tables.table,tables.schema)" ngbDropdownItem>{{tables.table}}</a></li>
                                    }
                                    <!-- <li><a class="dropdown-item" (click)="Openmdo(mdo)" ngbDropdownItem>{{PostGreSQL}}</a></li> -->
                                </ul>
                            </div>
                                    }
                                    @if(tableName){
                                    {{tableName}}
                                    }
                                </div>
                                <div class="card-body" style="padding: 0px;height: 200px;overflow: scroll;">
                                    <div class="table-responsive">
                                        <table class="table border text-nowrap text-md-nowrap table-sm mb-0">
                                            <thead>
                                                <tr>
                                                    @for(dataa of getTableColumns;track dataa;let i = $index){
                                                            <th>{{dataa.columns}}</th>                                                       
                                                    }                                                    
                                                </tr>
                                              
                                            </thead>
                                            <tbody>
                                                @for(rowss of getTableRows;track rowss;){
                                                <tr>
                                                    @for(rowdata of rowss;track rowdata;let i = $index){

                                                    <td>{{rowdata}}</td>
                                                    }
                                                </tr>
                                            }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xxl-6 col-xl-6 col-lg-6 col-md-6">

                        </div>
                    </div>
                   
                </div>
                }
            </div>
            </div>
    }
  